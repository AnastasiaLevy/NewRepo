function init(){btnFullScreenOn=document.getElementById("fullScreenOn"),btnFullScreenOn.onclick=function(){launchIntoFullscreen(document.documentElement)},btnFullScreenClose=document.getElementById("fullScreenClose"),btnFullScreenClose.onclick=function(){cancelFullscreen()},btnFullScreenOn=document.getElementById("fullScreenOn"),btnFullScreenOn.style.visibility="visible",btnExecuteTest=document.getElementById("executeTest"),btnExecuteTest.onclick=function(){executeTestDown(1)},testUpdate=new updateManager,currentScore=new scoreManager,drawGameCanvas(),showExecuteTest(),loopManager()}function drawGameCanvas(){ctx.fillStyle="#F8ECC2",ctx.fillRect(0,0,1e3,700),ctx.lineWidth=4,ctx.strokeStyle="#000",ctx.strokeRect(0,0,1e3,700)}function showMessage(){var a=10,b=20;if(ctx.fillStyle="#FFF",ctx.fillRect(rectangleTestMessage[currentTest-1][0],rectangleTestMessage[currentTest-1][1],rectangleTestMessage[currentTest-1][2],rectangleTestMessage[currentTest-1][3]),ctx.strokeStyle="#000",ctx.lineWidth=4,ctx.strokeRect(rectangleTestMessage[currentTest-1][0],rectangleTestMessage[currentTest-1][1],rectangleTestMessage[currentTest-1][2],rectangleTestMessage[currentTest-1][3]),ctx.font="bold 20px arial",ctx.fillStyle="#000",trial)for(i=0;i<testMessage1[currentTest-1].length;i++)ctx.fillText(testMessage1[currentTest-1][i],rectangleTestMessage[currentTest-1][0]+a,10+rectangleTestMessage[currentTest-1][1]+b*(i+1));else for(i=0;i<testMessage2[currentTest-1].length;i++)ctx.fillText(testMessage2[currentTest-1][i],rectangleTestMessage[currentTest-1][0]+a,10+rectangleTestMessage[currentTest-1][1]+b*(i+1))}function showResult(){for(ctx.fillStyle="#FFF",ctx.fillRect(rectangleResultMessage[0],rectangleResultMessage[1],rectangleResultMessage[2],rectangleResultMessage[3]),ctx.strokeStyle="#000",ctx.lineWidth=4,ctx.strokeRect(rectangleResultMessage[0],rectangleResultMessage[1],rectangleResultMessage[2],rectangleResultMessage[3]),ctx.font="bold 20px arial",ctx.fillStyle="#000",i=0;i<currentScore.scoreArray.length;i++){var a="";switch(i){case 0:a="Correct Answers";break;case 1:a="Incorrect Answers";break;case 2:a="Missed Correct Answers";break;case 3:a="Missed Incorrect Answers";break;case 4:a="No Response Answers";break;case 5:a="Average Time Correct Answers";break;case 6:a="Average Time Incorrect Answers";break;case 7:a="Average Time Missed Correct Answers";break;case 8:a="Average Time Missed Incorrect Answers";break;case 9:a="Average Time Response"}ctx.fillText(a+" : "+currentScore.scoreArray[i],rectangleResultMessage[0]+10,15+rectangleResultMessage[1]+30*(i+1))}}function drawResponseDisplay(){ctx.fillStyle="#d3d3d3",ctx.fillRect(70,500,860,170),ctx.linewidth=2,ctx.strokeStyle="#000",ctx.strokeRect(70,500,860,170),drawCircle(200,570,"#000","#FF0000","Yes"),drawCircle(800,570,"#000","#FF0000","No"),ctx.font="bold 36px arial",ctx.fillStyle="#000",ctx.fillText("Z",185,660),ctx.fillText("/?",782,660)}function keyYesNoPress(a){a?drawCircle(200,570,"black","#607334","Yes"):drawCircle(800,570,"black","#607334","No"),beep(250,800,.1)}function keyYesNoUp(){drawCircle(200,570,"#000","#FF0000","Yes"),drawCircle(800,570,"#000","#FF0000","No")}function drawCircle(a,b,c,d,e){ctx.save,ctx.fillStyle=d,ctx.beginPath(),ctx.lineWidth=7,ctx.strokeStyle=c,ctx.arc(a,b,50,Math.PI/180*0,Math.PI/180*360,!1),ctx.restore(),ctx.stroke(),ctx.closePath(),ctx.fill(),ctx.font="bold 36px arial",ctx.fillStyle="black",2==e.length?ctx.fillText(e,a-24,b+13):ctx.fillText(e,a-30,b+13)}function displayLetter(a){ctx.font="bold 100px arial",ctx.fillStyle="#000",ctx.fillText(a,450,350)}function hideLetter(a){drawGameCanvas(),drawResponseDisplay()}function showExecuteTest(){testState=1,btnExecuteTest.style.visibility="visible"}function hideExecuteTest(){btnExecuteTest.style.visibility="hidden"}function executeTestDown(a){currentTest=a,hideExecuteTest(),beginingTest()}function beginingTest(){testState=2,currentLetter=0,drawGameCanvas(),showMessage()}function changeTestNumber(){testGoing=!1,trial||3!=currentTest?(currentTest=trial?currentTest:currentTest+1,trial=!trial,beginingTest()):finishTest()}function startTest(){testState=3,testGoing=!0,testUpdate.setTestStarted(),drawGameCanvas(),drawResponseDisplay(),updateTestQuestion(!0)}function finishTest(){testState=5,canKeyClick=!1,drawGameCanvas(),console.log("getTestScore",currentScore.getTestScore()),showResult()}function updateTestQuestion(a){this.letter="",this.listLength=trial?nBackTrial[currentTest-1].length:nBackFull[currentTest-1].length,3==testState&&a&&0!=currentLetter&&(currentScore.setNoresponse(),currentScore.setAverageResponse(5e3)),a&&currentLetter<this.listLength?(testState=3,currentLetter++,this.letter=trial?nBackTrial[currentTest-1][currentLetter-1]:nBackFull[currentTest-1][currentLetter-1],displayLetter(this.letter),canKeyClick=!0,letterVisible=!0):currentLetter!=this.listLength||letterVisible?(hideLetter(),letterVisible=!1):changeTestNumber()}function checkAnswer(a){testState=4,canKeyClick=!1,keyYesNoPress(a),testUpdate.setCircleBackUnPressed();var b=trial?nBackTrial[currentTest-1][currentLetter-1]:nBackFull[currentTest-1][currentLetter-1],c=trial?nBackTrial[currentTest-1][currentLetter-(1+currentTest)]:nBackFull[currentTest-1][currentLetter-(1+currentTest)];a?b==c&&letterVisible?(currentScore.setCorrect(),currentScore.setTimeCorrect(testUpdate.getTimeResponse())):b!=c||letterVisible?b==c||letterVisible?(currentScore.setIncorrect(),currentScore.setTimeIncorrect(testUpdate.getTimeResponse())):(currentScore.setMissed(!1),currentScore.setTimeMissed(2e3+testUpdate.getTimeResponse(),!1)):(currentScore.setMissed(!0),currentScore.setTimeMissed(2e3+testUpdate.getTimeResponse(),!0)):b!=c&&letterVisible?(currentScore.setCorrect(),currentScore.setTimeCorrect(testUpdate.getTimeResponse())):b==c||letterVisible?b!=c||letterVisible?(currentScore.setIncorrect(),currentScore.setTimeIncorrect(testUpdate.getTimeResponse())):(currentScore.setMissed(!1),currentScore.setTimeMissed(2e3+testUpdate.getTimeResponse(),!1)):(currentScore.setMissed(!0),currentScore.setTimeMissed(2e3+testUpdate.getTimeResponse(),!0)),currentScore.setAverageResponse(letterVisible?testUpdate.getTimeResponse():2e3+testUpdate.getTimeResponse())}function beep(a,b,c,d,e){var f=audioCtx.createOscillator(),g=audioCtx.createGain();f.connect(g),g.connect(audioCtx.destination),c&&(g.gain.value=c),b&&(f.frequency.value=b),d&&(f.type=d),e&&(f.onended=e),f.start(),setTimeout(function(){f.stop()},a?a:500)}function spaceDown(a){2==testState&&startTest()}function yesDown(a){3==testState&&canKeyClick&&checkAnswer(!0)}function noDown(a){3==testState&&canKeyClick&&checkAnswer(!1)}function keyDown(a){switch(a.keyCode){case 32:spaceDown();break;case 90:yesDown();break;case 191:noDown()}}function updateManager(){this.UPDATE_FREQUENCY_SHOW_LETTER=2e3,this.UPDATE_FREQUENCY_HIDE_LETTER=3e3,this.UPDATE_FREQUENCY_UNPRESS=250,this.updateCounter=this.UPDATE_FREQUENCY_SHOW_LETTER,this.showLetter=!0,this.updateCounterUnPress=this.UPDATE_FREQUENCY_UNPRESS,this.needUnPress=!1,this.update=function(a){testGoing&&(this.updateCounter-=a,this.updateCounter<=0&&(this.showLetter?(this.updateCounter=this.UPDATE_FREQUENCY_HIDE_LETTER,this.showLetter=!1):(this.updateCounter=this.UPDATE_FREQUENCY_SHOW_LETTER,this.showLetter=!0),updateTestQuestion(this.showLetter))),this.needUnPress&&(this.updateCounterUnPress-=a,this.updateCounterUnPress<=0&&(keyYesNoUp(),this.needUnPress=!1))},this.getTimeResponse=function(){var a=this.showLetter?this.UPDATE_FREQUENCY_SHOW_LETTER-this.updateCounter:this.UPDATE_FREQUENCY_HIDE_LETTER-this.updateCounter;return a},this.setTestStarted=function(){this.updateCounter=this.UPDATE_FREQUENCY_SHOW_LETTER,this.showLetter=!0},this.setCircleBackUnPressed=function(){this.updateCounterUnPress=this.UPDATE_FREQUENCY_UNPRESS,this.needUnPress=!0}}function launchIntoFullscreen(a){btnFullScreenOn.style.visibility="hidden",btnFullScreenClose.style.visibility="visible",a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function cancelFullscreen(){btnFullScreenOn.style.visibility="visible",btnFullScreenClose.style.visibility="hidden",document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}var gameCanvas,ctx,canvasWidth=1e3,canvasHeight=700,btnExecuteTest,btnFullScreenOn,btnFullScreenClose,currentTest,currentLetter,testState,trial=!0,canKeyClick=!1,testGoing=!1,letterVisible=!1,testLoop={},testUpdate={},currentScore={},previousTime=0,audioCtx=new(window.AudioContext||window.webkitAudioContext||window.audioContext);window.onload=function(){gameCanvas=document.getElementById("canvas"),ctx=gameCanvas.getContext("2d"),document.addEventListener("keydown",keyDown),init(),window.onresize()},window.onresize=function(){var a=window.innerWidth,b=window.innerHeight,c=b>canvasHeight?(b-canvasHeight)/2:0,d=a>canvasWidth?(a-canvasWidth)/2:0;gameCanvas.style.top=c+"px",gameCanvas.style.left=d+"px",btnFullScreenOn.style.left=d+canvasWidth-btnFullScreenOn.offsetWidth-4+"px",btnFullScreenClose.style.left=d+canvasWidth-btnFullScreenClose.offsetWidth-4+"px",btnFullScreenOn.style.top=c+4+"px",btnFullScreenClose.style.top=c+4+"px",btnExecuteTest.style.left=d+canvasWidth/2-btnExecuteTest.offsetWidth/2+"px",btnExecuteTest.style.top=c+canvasHeight/2-btnExecuteTest.offsetHeight/2+"px"};var loopManager=function(){var a=(new Date).getTime(),b=a-previousTime;previousTime=a,testUpdate.update(b),testLoop=setTimeout(loopManager,20)};